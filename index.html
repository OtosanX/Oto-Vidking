<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Vidking Player Hub</title>
  <style>
    :root {
      --bg: #0c0c0f;
      --panel: #14141a;
      --accent: #e50914;
      --text: #f4f4f7;
      --muted: #9aa0b5;
      --border: #1f1f27;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: "Inter", system-ui, -apple-system, sans-serif;
      background: radial-gradient(circle at 10% 20%, rgba(229, 9, 20, 0.15), transparent 25%),
        radial-gradient(circle at 90% 10%, rgba(145, 70, 255, 0.12), transparent 22%),
        var(--bg);
      color: var(--text);
      min-height: 100vh;
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 16px 20px;
      position: sticky;
      top: 0;
      background: rgba(12, 12, 15, 0.9);
      backdrop-filter: blur(8px);
      border-bottom: 1px solid var(--border);
      z-index: 10;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 700;
      letter-spacing: 0.5px;
    }

    .brand button {
      background: var(--panel);
      color: var(--text);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 10px 14px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: all 0.2s ease;
    }

    .brand button:hover {
      border-color: var(--accent);
      color: var(--accent);
    }

    .controls {
      display: flex;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
    }

    .search {
      display: flex;
      align-items: center;
      gap: 8px;
      background: var(--panel);
      border: 1px solid var(--border);
      padding: 10px 12px;
      border-radius: 12px;
    }

    .search input, .search select {
      background: transparent;
      border: none;
      color: var(--text);
      outline: none;
      min-width: 80px;
    }

    .search button, .control-btn {
      background: linear-gradient(135deg, var(--accent), #ff4f5a);
      color: #fff;
      border: none;
      border-radius: 10px;
      padding: 10px 14px;
      cursor: pointer;
      font-weight: 600;
      transition: transform 0.15s ease, box-shadow 0.2s ease;
    }

    .search button:hover, .control-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 10px 30px rgba(229, 9, 20, 0.35);
    }

    .control-btn.secondary {
      background: var(--panel);
      color: var(--text);
      border: 1px solid var(--border);
      box-shadow: none;
    }

    main {
      display: grid;
      grid-template-columns: 320px 1fr;
      gap: 18px;
      padding: 18px 20px 32px;
    }

    .panel {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 16px;
      box-shadow: 0 18px 40px rgba(0,0,0,0.35);
    }

    .panel h3 {
      margin: 0 0 12px;
      font-size: 16px;
      letter-spacing: 0.3px;
      color: #fff;
    }

    .info-item {
      display: flex;
      justify-content: space-between;
      padding: 10px 12px;
      border-radius: 12px;
      background: #0f0f14;
      border: 1px solid var(--border);
      margin-bottom: 8px;
      color: var(--muted);
    }

    .info-item strong {
      color: var(--text);
    }

    .actions {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 12px;
    }

    .player-shell {
      background: #050507;
      border-radius: 16px;
      overflow: hidden;
      border: 1px solid var(--border);
      position: relative;
    }

    .player-shell header {
      position: static;
      border: none;
      background: none;
      padding: 12px 14px;
    }

    .player-frame {
      width: 100%;
      height: 600px;
      border: none;
      display: block;
      background: #000;
    }

    .theatre .player-frame {
      height: 80vh;
    }

    .badges {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      margin-bottom: 10px;
    }

    .pill {
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(229, 9, 20, 0.12);
      color: #ff6f7a;
      border: 1px solid rgba(229, 9, 20, 0.25);
      font-size: 12px;
      letter-spacing: 0.2px;
    }

    .toggle {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: #0f0f14;
      border: 1px solid var(--border);
      padding: 8px 10px;
      border-radius: 12px;
      cursor: pointer;
    }

    .toggle input {
      accent-color: var(--accent);
    }

    .status {
      color: var(--muted);
      font-size: 13px;
      margin-top: 6px;
    }

    @media (max-width: 960px) {
      main {
        grid-template-columns: 1fr;
      }

      header {
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
      }

      .controls {
        width: 100%;
      }

      .player-frame {
        height: 420px;
      }
    }
  </style>
  <script src="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1" async></script>
</head>
<body>
  <header>
    <div class="brand">
      <button id="homeBtn" title="Reset to home">üè† Home</button>
      <div>Vidking Control Panel</div>
    </div>
    <div class="controls">
      <div class="search">
        <select id="mediaType">
          <option value="movie">Movie</option>
          <option value="tv">TV</option>
        </select>
        <input id="tmdbId" type="text" placeholder="TMDB ID" value="1078605" />
        <input id="seasonInput" type="number" min="1" value="1" title="Season" style="width: 80px;" />
        <input id="episodeInput" type="number" min="1" value="1" title="Episode" style="width: 90px;" />
        <button id="loadBtn">Play</button>
      </div>
      <button class="control-btn secondary" id="watchlistBtn">Ôºã Add to Watchlist</button>
      <button class="control-btn secondary" id="theatreBtn">üéûÔ∏è Theatre Mode</button>
      <button class="control-btn" id="castBtn" disabled>üì∫ Cast</button>
    </div>
  </header>

  <main>
    <section class="panel" aria-label="Info">
      <h3>Now Playing</h3>
      <div class="badges">
        <span class="pill" id="badgeType">Movie</span>
        <span class="pill" id="badgeAutoplay">Autoplay On</span>
        <span class="pill" id="badgeNext">Next Episode Ready</span>
      </div>
      <div class="info-item"><span>Title</span><strong id="infoTitle">TMDB #1078605</strong></div>
      <div class="info-item"><span>Season / Episode</span><strong id="infoEpisode">N/A</strong></div>
      <div class="info-item"><span>Color</span><strong id="infoColor">9146ff</strong></div>
      <div class="info-item"><span>Autoplay</span><strong id="infoAutoplay">true</strong></div>
      <div class="info-item"><span>Episode Selector</span><strong id="infoSelector">true</strong></div>
      <div class="actions">
        <label class="toggle"><input type="checkbox" id="autoPlayToggle" checked /> Autoplay</label>
        <label class="toggle"><input type="checkbox" id="selectorToggle" checked /> Episode selector</label>
        <label class="toggle"><input type="checkbox" id="nextToggle" checked /> Next episode</label>
      </div>
      <div class="status" id="status">Ready</div>
    </section>

    <section class="player-shell" id="playerShell">
      <iframe
        id="player"
        class="player-frame"
        src="https://www.vidking.net/embed/movie/1078605?autoPlay=true&nextEpisode=true&episodeSelector=true&color=9146ff"
        allow="autoplay; fullscreen; picture-in-picture; encrypted-media"
        allowfullscreen
        referrerpolicy="no-referrer"
      ></iframe>
    </section>
  </main>

  <script>
    const state = {
      mediaType: "movie",
      tmdbId: "1078605",
      season: 1,
      episode: 1,
      color: "9146ff",
      autoPlay: true,
      nextEpisode: true,
      episodeSelector: true,
      watchlist: new Set(JSON.parse(localStorage.getItem("watchlist") || "[]")),
    };

    const els = {
      mediaType: document.getElementById("mediaType"),
      tmdbId: document.getElementById("tmdbId"),
      season: document.getElementById("seasonInput"),
      episode: document.getElementById("episodeInput"),
      loadBtn: document.getElementById("loadBtn"),
      homeBtn: document.getElementById("homeBtn"),
      player: document.getElementById("player"),
      shell: document.getElementById("playerShell"),
      badgeType: document.getElementById("badgeType"),
      badgeAutoplay: document.getElementById("badgeAutoplay"),
      badgeNext: document.getElementById("badgeNext"),
      infoTitle: document.getElementById("infoTitle"),
      infoEpisode: document.getElementById("infoEpisode"),
      infoColor: document.getElementById("infoColor"),
      infoAutoplay: document.getElementById("infoAutoplay"),
      infoSelector: document.getElementById("infoSelector"),
      status: document.getElementById("status"),
      autoPlayToggle: document.getElementById("autoPlayToggle"),
      selectorToggle: document.getElementById("selectorToggle"),
      nextToggle: document.getElementById("nextToggle"),
      watchlistBtn: document.getElementById("watchlistBtn"),
      theatreBtn: document.getElementById("theatreBtn"),
      castBtn: document.getElementById("castBtn"),
    };

    function persistWatchlist() {
      localStorage.setItem("watchlist", JSON.stringify(Array.from(state.watchlist)));
    }

    function updateWatchlistButton() {
      const key = `${state.mediaType}:${state.tmdbId}`;
      const inList = state.watchlist.has(key);
      els.watchlistBtn.textContent = inList ? "‚úì In Watchlist" : "Ôºã Add to Watchlist";
      els.watchlistBtn.classList.toggle("active", inList);
    }

    function buildSrc() {
      const params = new URLSearchParams();
      params.set("color", state.color);
      if (state.autoPlay) params.set("autoPlay", "true");
      if (state.nextEpisode) params.set("nextEpisode", "true");
      if (state.episodeSelector) params.set("episodeSelector", "true");

      if (state.mediaType === "tv") {
        return `https://www.vidking.net/embed/tv/${state.tmdbId}/${state.season}/${state.episode}?${params.toString()}`;
      }
      return `https://www.vidking.net/embed/movie/${state.tmdbId}?${params.toString()}`;
    }

    function refreshInfo() {
      els.badgeType.textContent = state.mediaType === "tv" ? "TV" : "Movie";
      els.badgeAutoplay.textContent = state.autoPlay ? "Autoplay On" : "Autoplay Off";
      els.badgeNext.style.display = state.mediaType === "tv" && state.nextEpisode ? "inline-flex" : "none";
      els.infoTitle.textContent = `TMDB #${state.tmdbId}`;
      els.infoEpisode.textContent = state.mediaType === "tv" ? `S${state.season} ¬∑ E${state.episode}` : "N/A";
      els.infoColor.textContent = state.color;
      els.infoAutoplay.textContent = String(state.autoPlay);
      els.infoSelector.textContent = String(state.episodeSelector);
      els.season.style.display = state.mediaType === "tv" ? "inline-block" : "none";
      els.episode.style.display = state.mediaType === "tv" ? "inline-block" : "none";
      updateWatchlistButton();
    }

    function renderPlayer() {
      const src = buildSrc();
      els.player.src = src;
      els.status.textContent = `Loaded ${state.mediaType} ${state.tmdbId}${state.mediaType === "tv" ? ` S${state.season}E${state.episode}` : ""}`;
    }

    function resetHome() {
      state.mediaType = "movie";
      state.tmdbId = "1078605";
      state.season = 1;
      state.episode = 1;
      state.color = "9146ff";
      state.autoPlay = true;
      state.nextEpisode = true;
      state.episodeSelector = true;
      els.mediaType.value = state.mediaType;
      els.tmdbId.value = state.tmdbId;
      els.season.value = state.season;
      els.episode.value = state.episode;
      els.autoPlayToggle.checked = state.autoPlay;
      els.selectorToggle.checked = state.episodeSelector;
      els.nextToggle.checked = state.nextEpisode;
      refreshInfo();
      renderPlayer();
    }

    function applyStateFromInputs() {
      state.mediaType = els.mediaType.value;
      state.tmdbId = els.tmdbId.value.trim() || state.tmdbId;
      state.season = Number(els.season.value) || 1;
      state.episode = Number(els.episode.value) || 1;
      renderPlayer();
      refreshInfo();
    }

    function toggleTheatre() {
      const isTheatre = document.body.classList.toggle("theatre");
      els.theatreBtn.textContent = isTheatre ? "üñ•Ô∏è Exit Theatre" : "üéûÔ∏è Theatre Mode";
    }

    function initWatchlist() {
      els.watchlistBtn.addEventListener("click", () => {
        const key = `${state.mediaType}:${state.tmdbId}`;
        if (state.watchlist.has(key)) {
          state.watchlist.delete(key);
        } else {
          state.watchlist.add(key);
        }
        persistWatchlist();
        updateWatchlistButton();
      });
      updateWatchlistButton();
    }

    function setupToggles() {
      els.autoPlayToggle.addEventListener("change", () => {
        state.autoPlay = els.autoPlayToggle.checked;
        refreshInfo();
        renderPlayer();
      });
      els.selectorToggle.addEventListener("change", () => {
        state.episodeSelector = els.selectorToggle.checked;
        refreshInfo();
        renderPlayer();
      });
      els.nextToggle.addEventListener("change", () => {
        state.nextEpisode = els.nextToggle.checked;
        refreshInfo();
        renderPlayer();
      });
    }

    function initCasting() {
      const castBtn = els.castBtn;
      const context = window.cast && cast.framework ? cast.framework.CastContext.getInstance() : null;
      if (!context) {
        window.__onGCastApiAvailable = (isAvailable) => {
          if (isAvailable) initCasting();
        };
        return;
      }

      context.setOptions({
        receiverApplicationId: chrome.cast.media.DEFAULT_MEDIA_RECEIVER_APP_ID,
        autoJoinPolicy: chrome.cast.AutoJoinPolicy.ORIGIN_SCOPED,
      });

      castBtn.disabled = false;
      castBtn.title = "Cast to Chromecast";

      castBtn.addEventListener("click", async () => {
        try {
          await context.requestSession();
          const session = context.getCurrentSession();
          if (!session) return;

          const mediaInfo = new chrome.cast.media.MediaInfo(buildSrc(), "video/mp4");
          mediaInfo.metadata = new chrome.cast.media.GenericMediaMetadata();
          mediaInfo.metadata.title = `Vidking ${state.mediaType} ${state.tmdbId}`;

          const request = new chrome.cast.media.LoadRequest(mediaInfo);
          request.autoplay = true;

          await session.loadMedia(request);
          els.status.textContent = "Casting to Chromecast";
        } catch (err) {
          console.error("Cast error", err);
          els.status.textContent = "Casting failed. Check Chromecast availability.";
        }
      });
    }

    function init() {
      els.loadBtn.addEventListener("click", applyStateFromInputs);
      els.homeBtn.addEventListener("click", resetHome);
      els.theatreBtn.addEventListener("click", toggleTheatre);
      els.mediaType.addEventListener("change", () => {
        const isTv = els.mediaType.value === "tv";
        els.season.style.display = isTv ? "inline-block" : "none";
        els.episode.style.display = isTv ? "inline-block" : "none";
        refreshInfo();
      });
      initWatchlist();
      setupToggles();
      refreshInfo();
      initCasting();
    }

    document.addEventListener("DOMContentLoaded", init);
  </script>
</body>
</html>
